<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>푸시업 트래커 - 우리팀 운동 기록</title>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f8f9fa;
            min-height: 100vh;
            color: #2c3e50;
        }

        .container {
            background-color: #ffffff;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border: 1px solid #e9ecef;
        }

        h1 {
            color: #2c3e50;
            margin-bottom: 30px;
            font-size: 32px;
            font-weight: 300;
            text-align: center;
        }

        .nav-menu {
            margin-bottom: 40px;
            padding: 20px;
            background-color: #f1f3f4;
            border-radius: 10px;
            text-align: center;
        }

        .nav-btn {
            background-color: #6c757d;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            margin: 0 8px;
            text-decoration: none;
            display: inline-block;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .nav-btn:hover {
            background-color: #495057;
            transform: translateY(-2px);
        }

        .date-input-section {
            margin-bottom: 40px;
            text-align: center;
        }

        .date-input-section label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #495057;
            font-size: 18px;
        }

        .date-input-section input {
            padding: 15px 20px;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            font-size: 18px;
            background-color: #ffffff;
            transition: all 0.3s ease;
            width: 250px;
        }

        .date-input-section input:focus {
            outline: none;
            border-color: #6c757d;
            box-shadow: 0 0 0 3px rgba(108, 117, 125, 0.1);
        }

        .section-title {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 24px;
            font-weight: 500;
            text-align: center;
        }

        .member-table, .guest-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 30px;
            background-color: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .member-table th, .guest-table th {
            background-color: #f8f9fa;
            color: #495057;
            font-weight: 700;
            padding: 18px 15px;
            text-align: center;
            border-bottom: 2px solid #dee2e6;
            font-size: 16px;
        }

        .guest-table th {
            background-color: #f5f2ed;
            border-bottom-color: #d4b896;
        }

        .member-table td, .guest-table td {
            padding: 15px;
            text-align: center;
            border-bottom: 1px solid #f0f0f0;
            vertical-align: middle;
        }

        .member-table tbody tr:hover, .guest-table tbody tr:hover {
            background-color: #f8f9fa;
        }

        .guest-table tbody tr:hover {
            background-color: #f5f2ed;
        }

        .member-name, .guest-name-cell {
            font-size: 18px;
            font-weight: 600;
            color: #2c3e50;
        }

        .guest-name-cell {
            color: #8b7355;
        }

        .pushup-input {
            width: 100%;
            max-width: 120px;
            text-align: center;
            font-size: 16px;
            font-weight: 600;
            border: 2px solid #dee2e6;
            padding: 10px 8px;
            border-radius: 6px;
            background-color: #ffffff;
            transition: all 0.3s ease;
        }

        .standard-input {
            border-color: #28a745;
        }

        .standard-input:focus {
            outline: none;
            border-color: #28a745;
            box-shadow: 0 0 0 3px rgba(40, 167, 69, 0.1);
        }

        .knee-input {
            border-color: #ffc107;
        }

        .knee-input:focus {
            outline: none;
            border-color: #ffc107;
            box-shadow: 0 0 0 3px rgba(255, 193, 7, 0.1);
        }

        .guest-input {
            border-color: #8b7355;
            max-width: 150px;
        }

        .guest-input:focus {
            outline: none;
            border-color: #8b7355;
            box-shadow: 0 0 0 3px rgba(139, 115, 85, 0.1);
        }

        .status-select {
            width: 100%;
            max-width: 100px;
            font-size: 14px;
            font-weight: 600;
            padding: 10px 8px;
            border: 2px solid #6f42c1;
            border-radius: 6px;
            background-color: #ffffff;
            text-align: center;
        }

        .status-select:focus {
            outline: none;
            border-color: #6f42c1;
            box-shadow: 0 0 0 3px rgba(111, 66, 193, 0.1);
        }

        .remove-guest-btn {
            background-color: #dc3545;
            color: white;
            padding: 8px 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .remove-guest-btn:hover {
            background-color: #c82333;
            transform: scale(1.05);
        }

        .add-guest-btn {
            background-color: #8b7355;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 20px;
            transition: all 0.3s ease;
            width: 100%;
        }

        .add-guest-btn:hover {
            background-color: #6d5a44;
            transform: translateY(-2px);
        }

        .save-btn {
            background-color: #28a745;
            color: white;
            padding: 20px 40px;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            font-size: 20px;
            font-weight: 600;
            width: 100%;
            margin-top: 40px;
            transition: all 0.3s ease;
        }

        .save-btn:hover {
            background-color: #218838;
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        .save-btn:disabled {
            background-color: #6c757d;
            cursor: not-allowed;
            transform: none;
        }

        /* Toast 메시지 스타일 */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: #28a745;
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 8px 25px rgba(40, 167, 69, 0.3);
            z-index: 1000;
            font-weight: 600;
            font-size: 16px;
            transform: translateX(100%);
            transition: transform 0.4s ease;
            max-width: 350px;
            word-wrap: break-word;
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast.success {
            background-color: #28a745;
            border-left: 4px solid #1e7e34;
        }

        .toast.error {
            background-color: #dc3545;
            border-left: 4px solid #bd2130;
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }

            .nav-btn {
                display: block;
                margin: 8px 0;
            }

            .date-input-section input {
                width: 100%;
            }

            .member-table, .guest-table {
                font-size: 14px;
            }

            .member-table th, .guest-table th {
                padding: 12px 8px;
                font-size: 14px;
            }

            .member-table td, .guest-table td {
                padding: 10px 5px;
            }

            .pushup-input {
                max-width: 80px;
                font-size: 14px;
                padding: 8px 4px;
            }

            .guest-input {
                max-width: 100px;
            }

            .status-select {
                max-width: 80px;
                font-size: 12px;
                padding: 8px 4px;
            }

            .toast {
                top: 10px;
                right: 10px;
                left: 10px;
                max-width: none;
                font-size: 14px;
                padding: 12px 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>푸시업 트래커</h1>

        <div class="nav-menu">
            <a href="/" class="nav-btn">기록 입력</a>
            <a href="/records" class="nav-btn">기록 조회</a>
            <a href="/charts" class="nav-btn">전체 분석</a>
            <a href="/growth" class="nav-btn">개인 성장</a>
        </div>

        <div class="date-input-section">
            <label for="exercise-date">운동 날짜</label>
            <input type="date" id="exercise-date" required>
        </div>

        <div class="member-records">
            <h2 class="section-title">정규 팀원 기록</h2>

            <table class="member-table">
                <thead>
                    <tr>
                        <th>팀원</th>
                        <th>정자세</th>
                        <th>무릎자세</th>
                        <th>상태</th>
                    </tr>
                </thead>
                <tbody id="member-tbody">
                    <!-- 팀원 행들이 여기에 동적으로 추가됨 -->
                </tbody>
            </table>
        </div>

        <div class="guest-records">
            <h2 class="section-title">오늘의 게스트</h2>

            <table class="guest-table">
                <thead>
                    <tr>
                        <th>이름</th>
                        <th>정자세</th>
                        <th>무릎자세</th>
                        <th>삭제</th>
                    </tr>
                </thead>
                <tbody id="guest-tbody">
                    <!-- 게스트 행들이 여기에 동적으로 추가됨 -->
                </tbody>
            </table>

            <button type="button" class="add-guest-btn" onclick="addGuest()">
                게스트 추가하기
            </button>
        </div>

        <button type="button" class="save-btn" onclick="saveRecord()">
            💪 오늘의 기록 저장하기
        </button>
    </div>

    <script>
        const teamMembers = ['병선', '유경', '선주', '효성', '현정', '재욱'];
        let guestCounter = 0;

        // Toast 메시지 함수들
        function showSuccessToast(message) {
            const existingToast = document.querySelector('.toast');
            if (existingToast) {
                existingToast.remove();
            }

            const toast = document.createElement('div');
            toast.className = 'toast success';
            toast.textContent = message;

            document.body.appendChild(toast);

            setTimeout(() => {
                toast.classList.add('show');
            }, 100);

            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.remove();
                    }
                }, 400);
            }, 2500);
        }

        function showErrorToast(message) {
            const existingToast = document.querySelector('.toast');
            if (existingToast) {
                existingToast.remove();
            }

            const toast = document.createElement('div');
            toast.className = 'toast error';
            toast.textContent = message;

            document.body.appendChild(toast);

            setTimeout(() => {
                toast.classList.add('show');
            }, 100);

            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.remove();
                    }
                }, 400);
            }, 3000);
        }

        // 페이지 로드 후 초기화
        document.addEventListener('DOMContentLoaded', function() {
            // 오늘 날짜 설정
            const today = new Date();
            const dateString = today.getFullYear() + '-' +
                             String(today.getMonth() + 1).padStart(2, '0') + '-' +
                             String(today.getDate()).padStart(2, '0');

            const dateInput = document.getElementById('exercise-date');
            if (dateInput) {
                dateInput.value = dateString;
            }

            // 팀원 테이블 생성
            createMemberTable();

            // 게스트 기본 하나 추가
            addGuest();
        });

        function createMemberTable() {
            const tbody = document.getElementById('member-tbody');
            if (!tbody) return;

            tbody.innerHTML = '';

            teamMembers.forEach(function(memberName, index) {
                const row = document.createElement('tr');

                row.innerHTML = `
                    <td class="member-name">${memberName}</td>
                    <td>
                        <input type="number"
                               class="pushup-input standard-input"
                               id="standard-${index}"
                               min="0"
                               max="1000"
                               placeholder="0"
                               data-member="${memberName}"
                               data-type="standard">
                    </td>
                    <td>
                        <input type="number"
                               class="pushup-input knee-input"
                               id="knee-${index}"
                               min="0"
                               max="1000"
                               placeholder="0"
                               data-member="${memberName}"
                               data-type="knee">
                    </td>
                    <td>
                        <select class="status-select"
                                id="status-${index}"
                                data-member="${memberName}"
                                onchange="handleStatusChange(${index})">
                            <option value="participate">참여</option>
                            <option value="absent">미참여</option>
                        </select>
                    </td>
                `;

                tbody.appendChild(row);
            });
        }

        function addGuest() {
            const tbody = document.getElementById('guest-tbody');
            if (!tbody) return;

            const guestId = guestCounter++;
            const row = document.createElement('tr');
            row.id = `guest-row-${guestId}`;

            row.innerHTML = `
                <td>
                    <input type="text"
                           class="pushup-input guest-input"
                           id="guest-name-${guestId}"
                           placeholder="게스트 이름"
                           data-guest-id="${guestId}">
                </td>
                <td>
                    <input type="number"
                           class="pushup-input standard-input"
                           id="guest-standard-${guestId}"
                           min="0"
                           max="1000"
                           placeholder="0"
                           data-guest-id="${guestId}">
                </td>
                <td>
                    <input type="number"
                           class="pushup-input knee-input"
                           id="guest-knee-${guestId}"
                           min="0"
                           max="1000"
                           placeholder="0"
                           data-guest-id="${guestId}">
                </td>
                <td>
                    <button type="button" class="remove-guest-btn" onclick="removeGuest(${guestId})">
                        삭제
                    </button>
                </td>
            `;

            tbody.appendChild(row);
        }

        function removeGuest(guestId) {
            const guestRow = document.getElementById(`guest-row-${guestId}`);
            if (guestRow) {
                guestRow.remove();
            }
        }

        function handleStatusChange(index) {
            const statusSelect = document.getElementById(`status-${index}`);
            const standardInput = document.getElementById(`standard-${index}`);
            const kneeInput = document.getElementById(`knee-${index}`);

            if (statusSelect.value === 'absent') {
                standardInput.disabled = true;
                kneeInput.disabled = true;
                standardInput.value = '';
                kneeInput.value = '';
                standardInput.style.backgroundColor = '#f0f0f0';
                kneeInput.style.backgroundColor = '#f0f0f0';
            } else {
                standardInput.disabled = false;
                kneeInput.disabled = false;
                standardInput.style.backgroundColor = 'white';
                kneeInput.style.backgroundColor = 'white';
            }
        }

        function saveRecord() {
            const date = document.getElementById('exercise-date').value;
            const time = 10; // 고정값

            if (!date) {
                showErrorToast('운동 날짜를 선택해주세요!');
                return;
            }

            const memberData = [];
            teamMembers.forEach(function(memberName, index) {
                const statusSelect = document.getElementById(`status-${index}`);
                const standardInput = document.getElementById(`standard-${index}`);
                const kneeInput = document.getElementById(`knee-${index}`);

                const status = statusSelect.value;
                const standardCount = parseInt(standardInput.value) || 0;
                const kneeCount = parseInt(kneeInput.value) || 0;

                memberData.push({
                    name: memberName,
                    status: status,
                    standard_pushups: standardCount,
                    knee_pushups: kneeCount,
                    total_pushups: standardCount + kneeCount,
                    type: 'regular'
                });
            });

            const guestData = [];
            const guestRows = document.querySelectorAll('[id^="guest-row-"]');

            guestRows.forEach(function(row) {
                const guestId = row.id.split('-')[2];
                const nameInput = document.getElementById(`guest-name-${guestId}`);
                const standardInput = document.getElementById(`guest-standard-${guestId}`);
                const kneeInput = document.getElementById(`guest-knee-${guestId}`);

                const name = nameInput.value.trim();
                const standardCount = parseInt(standardInput.value) || 0;
                const kneeCount = parseInt(kneeInput.value) || 0;

                if (name) {
                    guestData.push({
                        name: name,
                        status: 'participate',
                        standard_pushups: standardCount,
                        knee_pushups: kneeCount,
                        total_pushups: standardCount + kneeCount,
                        type: 'guest'
                    });
                }
            });

            const recordData = {
                date: date,
                time: time,
                members: memberData,
                guests: guestData
            };

            const saveBtn = document.querySelector('.save-btn');
            saveBtn.disabled = true;
            saveBtn.textContent = '저장 중...';

            fetch('/save_record', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(recordData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    const participantCount = memberData.filter(member => member.status === 'participate').length;
                    const guestCount = guestData.length;
                    const totalStandard = [...memberData, ...guestData].reduce((sum, person) => sum + person.standard_pushups, 0);
                    const totalKnee = [...memberData, ...guestData].reduce((sum, person) => sum + person.knee_pushups, 0);
                    const totalPushups = totalStandard + totalKnee;

                    let toastMessage = `기록 저장 완료! 총 ${totalPushups}개 💪`;
                    if (guestCount > 0) {
                        toastMessage = `저장 완료! 정규팀원 ${participantCount}명, 게스트 ${guestCount}명 | 총 ${totalPushups}개 💪`;
                    }

                    showSuccessToast(toastMessage);

                    setTimeout(() => {
                        window.location.href = '/records';
                    }, 1000);

                } else {
                    showErrorToast('저장 실패: ' + data.message);
                }
            })
            .catch(error => {
                console.error('저장 오류:', error);
                showErrorToast('저장 중 오류가 발생했습니다.');
            })
            .finally(() => {
                saveBtn.disabled = false;
                saveBtn.textContent = '💪 오늘의 기록 저장하기';
            });
        }
    </script>
</body>
</html>